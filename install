DOTFILES="$HOME/.dotfiles"

hash git 2>&- || { echo >&2 "Missing Git!"; exit 1; }
git clone -q https://github.com/tobiassjosten/dotfiles.git $DOTFILES

[ ! -d $DOTFILES ] && { echo "Could not clone the dotfiles repository."; exit 1; }

FILES=$(find $DOTFILES -type f | grep -Ev '(\.git|install|README)')
for FILE in $FILES; do
  FILENAME=".$(basename $FILE)"

  if [ -f "$HOME/$FILENAME" -a ! -f "$HOME/$FILENAME.bak" ]; then
    mv "$HOME/$FILENAME" "$HOME/$FILENAME.bak"
  fi

  if [ -f "$HOME/$FILENAME" ]; then
    rm "$HOME/$FILENAME"
  fi

  ln -s $FILE "$HOME/$FILENAME"
done
