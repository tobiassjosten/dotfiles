SCRIPTDIR="$(cd "$(dirname "${BASH_SOURCE}")" && pwd)"
if [ "$(pwd)" != "$SCRIPTDIR" ]; then
    wget -q https://github.com/tobiassjosten/dotfiles/archive/master.zip -O /tmp/dotfiles.zip
    unzip -oq /tmp/dotfiles.zip -d /tmp
    cd /tmp/dotfiles-master
fi

sudo apt-get -qq install puppet
MODULES='maestrodev-wget puppetlabs-apt puppetlabs-vcsrepo puppetlabs-apache willdurand-composer'
for module in $MODULES; do
    if ! puppet module list --modulepath=modules | grep $module > /dev/null; then
        puppet module install --modulepath=modules $module > /dev/null
    fi
done
sudo puppet apply --modulepath=modules site.pp
